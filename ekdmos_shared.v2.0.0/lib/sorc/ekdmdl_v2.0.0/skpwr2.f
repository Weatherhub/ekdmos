      SUBROUTINE SKPWR2(KFILDO,KFILIO,KSKIP,KWRITE,KCHECK,
     1                  CCALL,ND1,NSTA,
     2                  CCALLD,NDX,IPACK,ND5,
     3                  NTOTBY,NTOTRC,L3264B,L3264W,IER)
C
C        MAY       2006   GLAHN   MOS-2000
C                                 ADAPTED FROM SKIPWR;  CALL 
C                                 SEQUENCE LEFT INTACT, ALTHOUGH
C                                 SOME VARIABLES NOT USED
C        JUNE      2006   GLAHN   ADDED WRITE /D 221
C        JULY      2006   JPD     MODIFIED FORMAT STATEMENT
C                                 225 TO MEET FORTRAN 90
C                                 STANDARDS ON THE IBM
C
C        PURPOSE
C           TO WRITE CALL LETTERS RECORD WHEN KWRITE NE 0.
C           KSKIP AND KCHECK ARE NOT OPERATIVE.  ESSENTIALLY,
C           SKIPWR, WHICH BOTH SKIPPED RECORDS AND WROTE CALL
C           LETTERS RECORDS, WAS DIVIDED INTO SKPWR1, WHICH ONLY
C           SKIPS, AND SKPWR2, WHICH ONLY WRITES CALL LETTERS
C           RECORDS AND DATA.  THIS WAS NECESSARY FOR U155/U450
C           BECAUSE SKIPWR INITIALIZED NOTOBY, THE BYTES IN THE
C           FILE, AND NTOTRC, THE NUMBER OF RECORDS IN THE FILE,
C           TO ZERO.  TO RETAIN THE SKIPPING FEATURE, SKPWR1 IS
C           CALLED ONCE IN U155, AND SKPWR2 IS CALLED IN U450 AS
C           MANY TIMES AS NEEDED.  BECAUSE U450 REDUCES THE STATION
C           LIST TO A MORE USEFUL ISZE, THIS SIZE WILL LIKELY VARY
C           FOR EACH RECORD TO WRITE, SO A TRAILER IS WRITTEN 
C           BEFORE EXIT FROM U405A AND A NEW CALL LETTERS RECORD IS
C           WRITTEN UPON ENTRY AS NEEDED.  THE CALL SEQUENCE WAS
C           LEFT INTACT ALTHOUGH NOT ALL VARIABLES ARE USED.
C
C        COMMENT
C           UNUSUAL CONDITIONS CAUSE A **** DIAGNOSTIC.  USUAL
C           CONDITIONS CAUSE A **** DIAGNOSTIC ONLY WITH /D COMPILE.
C   
C        DATA SET USE
C            KFILDO    - UNIT NUMBER OF OUTPUT (PRINT) FILE.  (OUTPUT)
C            KFILIO    - UNIT NUMBER OF OUTPUT FILE.  (OUTPUT)
C
C        VARIABLES
C              KFILDO = UNIT NUMBER OF OUTPUT (PRINT) FILE.  (INPUT)
C              KFILIO = UNIT NUMBER OF OUTPUT FILE.  IF KFILIO = 0,
C                       THIS IS A DO NOTHING ROUTINE.  (INPUT)
C               KSKIP = NOT USED.  (INPUT)
C              KWRITE = 0 IF CALL LETTERS RECORD IS NOT TO BE WRITTEN.
C                       NE 0 OTHERWISE.  (INPUT)
C              KCHECK = NOT USED.  (INPUT)
C          CCALL(K,J) = 8 STATION CALL LETTERS (K=1,NSTA).  THE PRIMARY
C                       STATIONS ARE IN CCALL( ,1), BUT ANY SUBSTITUTE
C                       STATION IN J=2,5 WILL BE ACCEPTED.
C                       (CHARACTER*8)  (INPUT)
C                 ND1 = 1ST DIMENSION OF CCALL( , ).  (INPUT)
C                NSTA = THE NUMBER OF CALL LETTERS IN CCALL( , ).  (INPUT)
C           CCALLD(K) = 8 STATION CALL LETTERS (K=1,NDX).  THIS VARIABLE 
C                       HOLDS THE LIST OF STATIONS ALREADY ON THE OUTPUT
C                       FILE WHEN DATA ARE SKIPPED ON IT.  IT IS USED
C                       TO CHECK THE LIST TO WRITE WHEN DESIRED.  WHEN
C                       THE LISTS DO NOT AGREE, THE PROGRAM RESPONDS
C                       TO KWRITE.  (CHARACTER*8)  (INTERNAL)
C                 NDX = DIMENSION OF CCALLD( ).  THIS MAY BE ND1, ND5, OR
C                       SOME OTHER VALUE IN CALLING PROGRAMS.  GENERALLY,
C                       PROGRAMS WILL HAVE CCALLD( ), IPACK( ) AND 
C                       OTHER VARIABLES DIMENSIONED ND5.  (INPUT)
C            IPACK(J) = WORK ARRAY (J=1,ND5).  (INTERNAL)
C                 ND5 = DIMENSION OF IPACK( ).  (INPUT)
C              NTOTBY = THE TOTAL NUMBER OF BYTES ON THE FILE.  IT IS
C                       INITIALIZED, AND THE BYTES ARE COUNTED WHEN 
C                       SKIPPING RECORDS AND WRITING CALL LETTERS RECORDS.
C                       (OUTPUT)
C              NTOTRC = THE TOTAL NUMBER OF RECORDS ON THE FILE.  IT IS
C                       INITIALIZED, AND THE RECORDS ARE COUNTED WHEN 
C                       SKIPPING RECORDS AND WRITING CALL LETTERS RECORDS.
C                       (OUTPUT)
C              L3264B = WORD LENGTH IN BITS OF MACHINE BEING USED.
C                       (INPUT)
C              L3264W = THE NUMBER OF 32-BIT "WORDS" TO CONTAIN 64 BITS.
C                       2 FOR 32-BIT MACHINE, 1 FOR 64-BIT MACHINE.
C                 IER = STATUS RETURN.
C                         0 = GOOD RETURN.
C                       140 = ERROR READING CALL LETTERS RECORD.
C                       141 = CCALLD( ) ARRAY NOT LARGE ENOUGH.
C                       142 = CALL LETTERS READ FROM FILE DO NOT MATCH
C                             CCALL( , ).
C                       143 = ERROR WHEN SKIPPING RECORDS.
C                       144 = ERROR WRITING CALL LETTERS RECORD.
C                       147 = IMPOSSIBLE SITUATION.
C                       148 = ND5 TOO SMALL.
C                       OTHER RETURNS FROM UNPKBG OR PKBG.
C                       (OUTPUT)
C           NBYTES(L) = USED TO ACCESS DATA AS EITHER 2 WORDS FOR A 32-BIT
C                       MACHINE OR 1 WORD FOR A 64-BIT MACHINE (L=1,2).
C                       (INTERNAL)
C               IDATE = DATE/TIME OF RECORD READ.  (INTERNAL)
C               NSTA1 = NUMBER OF STATIONS IN THE LIST READ FROM THE
C                       OLD OUTPUT FILE.  (INTERNAL)
C              BLANK8 = 8 BLANKS.  USED TO BLANK OUT ARRAY SO IF
C                       THE LISTS DON'T MATCH AND ARE PRINTED, THE
C                       CHARACTERS WILL BE PRINTABLE.  (CHARACTER*8)
C                       (INTERNAL)
C              ISHORT = THE NUMBER OF WORDS IN A TRAILER RECORD,
C                       FOLLOWING THE INITIAL 8 BYTES.  (INTERNAL)
C                IWRT = 0 WHEN CALL LETTERS RECORD IS CHECKED AND
C                         AGREES WITH THE ONE PROVIDED IN CCALL( , ).
C                       1 WHEN THERE IS NOT AGREEMENT, OR DIRECTORY
C                         IS TO BE WRITTEN.
C                       (INTERNAL)
C           CCALLX(K) = 8 STATION CALL LETTERS (K=1,NDX).  THIS VARIABLE 
C                       HOLDS THE PREVIOUSLY READ LIST OF STATIONS
C                       ALREADY ON THE OUTPUT FILE WHEN DATA ARE SKIPPED 
C                       ON IT.  IT IS USED TO CHECK THE LIST TO 
C                       WRITE WHEN DESIRED.  WHEN THE LISTS DO NOT
C                       AGREE, THE PROGRAM RESPONDS TO KWRITE.  THIS
C                       VARIABLE, IN ADDITION TO CCALLD( ), IS NECESSARY
C                       TO KEEP A DIRECTORY AND TRAILER TO BE KEPT
C                       WITH NO DATA BETWEEN.  THIS MIGHT HAPPEN WITH
C                       MULTIPLE RUNS WHERE THE SAME KSKIP WERE USED WITH
C                       KWRITE = 1 AND THE STATIONS IN CCALL( , )
C                       DIFFERENT ON THE RUNS.
C                       (CHARACTER*8)  (AUTOMATIC-INTERNAL)
C               NSTAP = THE NUMBER OF CALL LETTERS IN CCALLX( ).
C                       (INTERNAL)
C                LAST = 9999 WHEN THE LAST RECORD READ WAS A TRAILER.
C                       0 OTHERWISE.  (INTERNAL)
C
C        NONSYSTEM SUBROUTINES USED 
C            UNPKBG, TRAIL
C
      CHARACTER*8 CCALL(ND1,6)
      CHARACTER*8 CCALLD(NDX)
      CHARACTER*8 BLANK8
      CHARACTER*8 CCALLX(NDX)
C        CCALLX( ) IS AN AUTOMATIC ARRAY.
C
      DIMENSION IPACK(ND5)
      DIMENSION NBYTES(2)
C
      DATA BLANK8/' '/
C
      IER=0
C
C        SET NBYTES( ) = 0 AND COUNT RECORDS.
C
      NBYTES(1)=0
      NBYTES(2)=0
      ICOUNT=0
C
 220  IF(KWRITE.NE.0)THEN
D        WRITE(KFILDO,221)KFILIO
D221     FORMAT(' IN SKIPWR2 WRITING CALL LETTERS RECORD UNIT NO.',I4)
C
         NBYTES(L3264W)=NSTA*8
         WRITE(KFILIO,IOSTAT=IOS,ERR=230)(NBYTES(J),J=1,L3264W),
     1                  (CCALL(K,1),K=1,NSTA)
         NTOTRC=NTOTRC+1
         NTOTBY=NTOTBY+NSTA*8+8
         WRITE(KFILDO,225)NSTA,NTOTRC,KFILIO,NTOTBY
 225     FORMAT(/,' WRITING CALL LETTERS RECORD IN SKPWR2',/,
     1            '    NUMBER OF STATIONS =                 ',I11,/,
     2            '    NUMBER OF RECORDS ON FILE =          ',I11,/,
     3            '    TOTAL BYTES IN FILE UNIT NO.',I4,'     ',I11)
         GO TO 300
C
 230     WRITE(KFILDO,231)KFILKO,IOS
 231     FORMAT(/,' ****ERROR WRITING CALL LETTERS RECORD IN SKPWR2',
     1            ' ON UNIT NO.',I3,' AT 230.  IOSTAT =',I5)
         IER=144
C
      ENDIF
C
300   RETURN
      END
